#####################################################
# Run nest with the standard settings, but output to file
echo "running rgraph regression test"
${CMAKE_BINARY_DIR}/miniapp/miniapp.exe -f ${REG_TEST_N_G}

# Do a comparison
python compare.py data/rgraph.gdf spikes_0.gdf 0.01

# set if we have a failure in the comparison
if [ $? != 0 ]; then
    RGRAPH=1
fi

echo "running alltoall regression test"
${CMAKE_BINARY_DIR}/miniapp/miniapp.exe -f -m ${REG_TEST_N_G}
python compare.py data/alltoall.gdf spikes_0.gdf 0.01
if [ $? != 0 ]; then
    ALLTOALL=1
fi


echo "running ring regression test"
${CMAKE_BINARY_DIR}/miniapp/miniapp.exe -f -r ${REG_TEST_N_G}
python compare.py data/ring.gdf spikes_0.gdf 0.01
if [ $? != 0 ]; then
    RING=1
fi

###########################################################
# Display which test failed: It might be out of view due to the simulator output
if [ $RGRAPH ]; then
    echo "The rgraph test failed!"
    TEST_FAILED=1
fi
if [ $ALLTOALL ]; then
    echo "The all to all test failed!"
    TEST_FAILED=1
fi
if [ $RING ]; then
    echo "The ring test failed!"
    TEST_FAILED=1
fi

###########################################
# If any test failed exit with 1 exit value
if [ $TEST_FAILED ]; then
    exit 1
fi
